import requests
import os
import zipfile
import base64
from flask import Flask, request, jsonify

app = Flask(__name__)

@app.route('/webhook', methods=['POST'])
def webhook():
    webhook_data = request.get_json()

    # Extract "Bike Number" from the received JSON data
    bike_number = None
    if 'line_items' in webhook_data:
        for item in webhook_data['line_items']:
            if 'properties' in item and 'Bike Number' in item['properties']:
                bike_number = item['properties']['Bike Number']
                print(f"Bike Number: {bike_number}")
                break

    if bike_number:
        num_list = [
            '1', '11', '100', '104', '105', '106', '11', '112', '113', '115', '31'
        ]

        try:
            class_name = int(bike_number)
            if str(class_name) in num_list:
                position = num_list.index(str(class_name)) + 1
                print(f"The number {class_name} is at position {position} in the list.")
            else:
                print("Rider number not found in the list.")
        except ValueError:
            print("Please enter a valid number.")
    else:
        print("Bike Number not found in the JSON data.")

    return jsonify({'message': 'Webhook received successfully'}), 200

if __name__ == "__main__":
    app.run(debug=True)
